<!DOCTYPE plugin PUBLIC "-//JPF//Java Plug-in Manifest 1.0" "http://jpf.sourceforge.net/plugin_1_0.dtd">
<plugin id="com.tle.core.payment.storefront" version="1">
	<requires>
		<import plugin-id="com.tle.common.payment.storefront" exported="true" />
		<import plugin-id="com.tle.common.i18n" />
		<import plugin-id="com.tle.core.guice" />
		<import plugin-id="com.tle.core.hibernate" />
		<import plugin-id="com.tle.core.migration" />
		<import plugin-id="com.tle.core.entity.services" exported="true" />
		<import plugin-id="com.tle.common.beans" />
		<import plugin-id="com.tle.common.item" />
		<import plugin-id="com.tle.common.search" />
		<import plugin-id="com.tle.common.dynacollection" />
		<import plugin-id="com.tle.core.security" />
		<import plugin-id="com.tle.core.security.runasuser" />
		<import plugin-id="com.tle.core.services" />
		<import plugin-id="com.tle.core.settings" />
		<import plugin-id="com.tle.core.freetext" />
		<import plugin-id="com.tle.web.resources" />
		<import plugin-id="com.tle.core.dynacollection" />
		<import plugin-id="com.tle.core.payment.beans" exported="true" />
		<import plugin-id="com.tle.core.usermanagement.standard" />
		<import plugin-id="org.codehaus.jackson" />
		<import plugin-id="com.tle.core.hibernate.equella" />
		<import plugin-id="com.tle.core.scheduler" />
		<import plugin-id="com.tle.core.item" />
		<import plugin-id="com.tle.core.jackson" />
		<import plugin-id="com.tle.core.notification" />
		<import plugin-id="com.tle.web.api.item.equella.serializer" />
	</requires>

	<runtime>
		<library type="code" path="classes/" id="core">
			<export prefix="*" />
		</library>
		<library type="resources" path="resources/" id="resources" />
	</runtime>

	<extension plugin-id="com.tle.core.guice" point-id="module" id="guiceModules">
		<parameter id="class" value="com.tle.core.services.guice.ServicesModule" />
	</extension>

	<extension plugin-id="com.tle.common.i18n" point-id="bundle" id="strings">
		<parameter id="file" value="lang/i18n.properties" />
		<parameter id="group" value="resource-centre" />
	</extension>

	<extension plugin-id="com.tle.core.hibernate" point-id="domainObjects" id="storefrontObjects">
		<parameter id="class" value="com.tle.common.payment.storefront.entity.Store" />
		<parameter id="class" value="com.tle.common.payment.storefront.entity.Order" />
		<parameter id="class" value="com.tle.common.payment.storefront.entity.OrderStorePart" />
		<parameter id="class" value="com.tle.common.payment.storefront.entity.OrderItem" />
		<parameter id="class" value="com.tle.common.payment.storefront.entity.OrderHistory" />
		<parameter id="class" value="com.tle.common.payment.storefront.entity.Purchase" />
		<parameter id="class" value="com.tle.common.payment.storefront.entity.PurchaseItem" />
		<parameter id="class" value="com.tle.common.payment.storefront.entity.PurchasedContent" />
	</extension>

	<extension plugin-id="com.tle.core.migration" point-id="initialSchema" id="storefrontSchemaObjects">
		<parameter id="class" value="com.tle.common.payment.storefront.entity.Store" />
		<parameter id="class" value="com.tle.common.payment.storefront.entity.Order" />
		<parameter id="class" value="com.tle.common.payment.storefront.entity.OrderStorePart" />
		<parameter id="class" value="com.tle.common.payment.storefront.entity.OrderItem" />
		<parameter id="class" value="com.tle.common.payment.storefront.entity.OrderHistory" />
		<parameter id="class" value="com.tle.common.payment.storefront.entity.Purchase" />
		<parameter id="class" value="com.tle.common.payment.storefront.entity.PurchaseItem" />
		<parameter id="class" value="com.tle.common.payment.storefront.entity.PurchasedContent" />
	</extension>

	<extension plugin-id="com.tle.core.migration" point-id="migration" id="createStorefrontObjects">
		<parameter id="id" value="com.tle.core.payment.storefront.migration.CreateStorefrontEntities" />
		<parameter id="bean" value="bean:com.tle.core.payment.storefront.migration.CreateStorefrontSchema" />
		<parameter id="date" value="2012-06-21" />
	</extension>

	<extension plugin-id="com.tle.core.migration" point-id="migration" id="addTaxFieldMigration">
		<parameter id="id" value="com.tle.core.payment.storefront.migration.AddTaxFieldsMigration" />
		<parameter id="bean" value="bean:com.tle.core.payment.storefront.migration.AddTaxFieldsMigration" />
		<parameter id="obsoletedby" value="com.tle.core.payment.storefront.migration.CreateStorefrontEntities" />
		<parameter id="date" value="2012-10-11" />
	</extension>

	<extension plugin-id="com.tle.core.migration" point-id="migration" id="removeIconFieldMigration">
		<parameter id="id" value="com.tle.core.payment.storefront.migration.v60Beta.RemoveStoreIconUrlField" />
		<parameter id="bean" value="bean:com.tle.core.payment.storefront.migration.v60Beta.RemoveStoreIconUrlField" />
		<parameter id="obsoletedby" value="com.tle.core.payment.storefront.migration.CreateStorefrontEntities" />
		<parameter id="date" value="2012-09-20" />
	</extension>

	<extension plugin-id="com.tle.core.entity.services" point-id="xmlmigration" id="removeIconFieldXmlMigration">
		<parameter id="id" value="com.tle.core.payment.storefront.migration.forimport.RemoveStoreIconUrlFieldXmlMigration" />
		<parameter id="bean" value="bean:com.tle.core.payment.storefront.migration.forimport.RemoveStoreIconUrlFieldXmlMigration" />
	</extension>

	<extension plugin-id="com.tle.core.entity.services" point-id="entityService" id="storeService">
		<parameter id="serviceClass" value="bean:com.tle.core.payment.storefront.service.StoreService" />
		<parameter id="order" value="1000" />
	</extension>

	<extension plugin-id="com.tle.core.services" point-id="applicationEventListener" id="storelisteners">
		<parameter id="listener" value="bean:com.tle.core.payment.storefront.service.StoreService" />
		<parameter id="listenerClass" value="com.tle.core.events.listeners.UserChangeListener" />
		<parameter id="listenerClass" value="com.tle.core.events.listeners.ItemDefinitionDeletionListener" />
		<parameter id="listenerClass" value="com.tle.core.events.listeners.ItemDefinitionReferencesListener" />
	</extension>

	<extension plugin-id="com.tle.core.services" point-id="applicationEventListener" id="purchaselisteners">
		<parameter id="listener" value="bean:com.tle.core.payment.storefront.service.PurchaseService" />
		<parameter id="listenerClass" value="com.tle.core.events.listeners.UserChangeListener" />
	</extension>

	<extension plugin-id="com.tle.core.services" point-id="applicationEventListener" id="orderlisteners">
		<parameter id="listener" value="bean:com.tle.core.payment.storefront.service.OrderService" />
		<parameter id="listenerClass" value="com.tle.core.events.listeners.UserChangeListener" />
	</extension>

	<extension plugin-id="com.tle.core.security" point-id="privilegeTreeProviders" id="privilegeTreeProvider">
		<parameter id="provider" value="bean:com.tle.core.payment.storefront.privileges.StorePrivilegeTreeProvider" />
	</extension>

	<extension plugin-id="com.tle.core.security" point-id="privilegeTreeProviders" id="storefrontSettingsPrivilegeTreeProvider">
		<parameter id="provider" value="bean:com.tle.core.payment.storefront.privileges.StoreFrontSettingsPrivilegeTreeProvider" />
	</extension>

	<extension plugin-id="com.tle.core.security" point-id="privilegeTreeProviders" id="approvalsSettingsPrivilegeTreeProvider">
		<parameter id="provider" value="bean:com.tle.core.payment.storefront.privileges.ApprovalsSettingsPrivilegeTreeProvider" />
	</extension>

	<extension plugin-id="com.tle.core.security" point-id="domainObjectPrivilegeFilter" id="purchItemPrivilegeFilter">
		<parameter id="bean" value="bean:com.tle.core.payment.storefront.security.PurchasedItemPrivilegeFilter" />
	</extension>

	<extension plugin-id="com.tle.core.entity.services" point-id="converter" id="orderConverter">
		<parameter id="id" value="ORDER" />
		<parameter id="class" value="bean:com.tle.core.payment.storefront.converter.OrderConverter" />
		<parameter id="order" value="4000" />

		<parameter id="selections">
			<parameter id="id" value="ORDER" />
			<parameter id="nameKey" value="com.tle.core.payment.storefront.converter.order.name" />
		</parameter>
	</extension>

	<extension plugin-id="com.tle.core.entity.services" point-id="converter" id="purchaseConverter">
		<parameter id="id" value="PURCHASE" />
		<parameter id="class" value="bean:com.tle.core.payment.storefront.converter.PurchaseConverter" />
		<parameter id="order" value="4100" />

		<parameter id="selections">
			<parameter id="id" value="PURCHASE" />
			<parameter id="nameKey" value="com.tle.core.payment.storefront.converter.purchase.name" />
		</parameter>
	</extension>

	<extension plugin-id="com.tle.core.scheduler" point-id="scheduledTask" id="checkPur">
		<parameter id="id" value="com.tle.core.payment.storefront.task.CheckUpdatedPurchasedItemsTask" />
		<parameter id="bean" value="bean:com.tle.core.payment.storefront.service.PurchaseService" />
		<parameter id="frequency" value="daily" />
		<parameter id="scope" value="institution" />
	</extension>

	<extension plugin-id="com.tle.core.scheduler" point-id="scheduledTask" id="checkOrders">
		<parameter id="id" value="com.tle.core.payment.storefront.task.CheckCurrentOrdersTask" />
		<parameter id="bean" value="bean:com.tle.core.payment.storefront.service.OrderService" />
		<parameter id="frequency" value="hourly" />
		<parameter id="scope" value="institution" />
	</extension>

	<extension plugin-id="com.tle.core.freetext" point-id="indexingExtension" id="storeFrontIndexerExtension">
		<parameter id="class" value="bean:com.tle.core.payment.storefront.index.StoreFrontIndexer" />
	</extension>
</plugin>
